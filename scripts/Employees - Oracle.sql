-- EmployeesQX - Oracle.sql
-- Use SQL Developer or another Oracle administrator. Run this script.
-- It should create an EmployeesQX database schema.

DROP USER EmployeesQX CASCADE;
CREATE USER EmployeesQX
   IDENTIFIED BY queryX30
   DEFAULT TABLESPACE users
   TEMPORARY TABLESPACE temp
   QUOTA 10M ON users;

GRANT connect to EmployeesQX;
GRANT resource to EmployeesQX;
GRANT create session TO EmployeesQX;
GRANT create table TO EmployeesQX;
GRANT create view TO EmployeesQX;
GRANT create materialized view TO EmployeesQX;

CONN EmployeesQX/queryX30

-- DROP TABLE "datatypes";
-- DROP VIEW "Managers";
-- DROP MATERIALIZED VIEW "Materialized";
-- DROP TABLE "proj";
-- DROP TABLE "emp";
-- DROP TABLE "dept";

CREATE TABLE "dept" (
   "DEPTNO" integer NOT NULL,
   "DNAME" VARCHAR2(20) NOT NULL,
   "LOC" VARCHAR2(20) NOT NULL,
   
   PRIMARY KEY ("DEPTNO")
);

COMMENT ON TABLE "dept" IS 'All company''s departments, with employees';
COMMENT ON COLUMN "dept"."DEPTNO" IS 'Department''s identification number';
COMMENT ON COLUMN "dept"."DNAME" IS 'Name of the current department';
COMMENT ON COLUMN "dept"."LOC" IS 'Location of the current department';

INSERT INTO "dept" VALUES (10, 'ACCOUNTING', 'NEW YORK');
INSERT INTO "dept" VALUES (20, 'RESEARCH', 'DALLAS');
INSERT INTO "dept" VALUES (30, 'SALES', 'CHICAGO');
INSERT INTO "dept" VALUES (40, 'OPERATIONS', 'BOSTON');


CREATE TABLE "emp" (
   "EMPNO" integer NOT NULL,
   "ENAME" VARCHAR2(20) NOT NULL,
   "JOB" VARCHAR2(20) NOT NULL,
   "MGR" integer,
   "HIREDATE" date NOT NULL,
   "SAL" integer NOT NULL,
   "COMM" integer,
   "DEPTNO" integer NOT NULL,
   
   PRIMARY KEY ("EMPNO"),
   CONSTRAINT "fk_MGR" FOREIGN KEY ("MGR") REFERENCES "emp" ("EMPNO")
      ON DELETE SET NULL,
   CONSTRAINT "fk_DEPTNO" FOREIGN KEY ("DEPTNO") REFERENCES "dept" ("DEPTNO")
);

INSERT INTO "emp" VALUES (7839, 'KING', 'PRESIDENT', NULL, TO_DATE('1981-11-17', 'YYYY-MM-DD'), 5000, NULL, 10);
INSERT INTO "emp" VALUES (7698, 'BLAKE', 'MANAGER', 7839, TO_DATE('1981-05-01', 'YYYY-MM-DD'), 2850, NULL, 30);
INSERT INTO "emp" VALUES (7654, 'MARTIN', 'SALESMAN', 7698, TO_DATE('1981-09-28', 'YYYY-MM-DD'), 1250, 1400, 30);
INSERT INTO "emp" VALUES (7499, 'ALLEN', 'SALESMAN', 7698, TO_DATE('1981-02-20', 'YYYY-MM-DD'), 1600, 300, 30);
INSERT INTO "emp" VALUES (7521, 'WARD', 'SALESMAN', 7698, TO_DATE('1981-02-22', 'YYYY-MM-DD'), 1250, 500, 30);
INSERT INTO "emp" VALUES (7900, 'JAMES', 'CLERK', 7698, TO_DATE('1981-12-03', 'YYYY-MM-DD'), 950, NULL, 30);
INSERT INTO "emp" VALUES (7844, 'TURNER', 'SALESMAN', 7698, TO_DATE('1981-09-08', 'YYYY-MM-DD'), 1500, 0, 30);
INSERT INTO "emp" VALUES (7782, 'CLARK', 'MANAGER', 7839, TO_DATE('1981-06-09', 'YYYY-MM-DD'), 2450, NULL, 10);
INSERT INTO "emp" VALUES (7934, 'MILLER', 'CLERK', 7782, TO_DATE('1982-01-23', 'YYYY-MM-DD'), 1300, NULL, 10);
INSERT INTO "emp" VALUES (7566, 'JONES', 'MANAGER', 7839, TO_DATE('1981-04-02', 'YYYY-MM-DD'), 2975, NULL, 20);
INSERT INTO "emp" VALUES (7788, 'SCOTT', 'ANALYST', 7566, TO_DATE('1982-12-09', 'YYYY-MM-DD'), 3000, NULL, 20);
INSERT INTO "emp" VALUES (7876, 'ADAMS', 'CLERK', 7788, TO_DATE('1983-01-12', 'YYYY-MM-DD'), 1100, NULL, 20);
INSERT INTO "emp" VALUES (7902, 'FORD', 'ANALYST', 7566, TO_DATE('1981-12-03', 'YYYY-MM-DD'), 3000, NULL, 20);
INSERT INTO "emp" VALUES (7369, 'SMITH', 'CLERK', 7902, TO_DATE('1980-12-17', 'YYYY-MM-DD'), 800, NULL, 20);


CREATE TABLE "proj" (
   "PROJID" integer NOT NULL,
   "EMPNO" integer NOT NULL,
   "STARTDATE" date NOT NULL,
   "ENDDATE" date NOT NULL,
   
   PRIMARY KEY ("PROJID"),
   CONSTRAINT "fk_PROJ" FOREIGN KEY ("EMPNO") REFERENCES "emp" ("EMPNO")
      ON DELETE CASCADE
);

INSERT INTO "proj" VALUES (1, 7782, TO_DATE('2005-06-16', 'YYYY-MM-DD'), TO_DATE('2005-06-18', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (4, 7782, TO_DATE('2005-06-19', 'YYYY-MM-DD'), TO_DATE('2005-06-24', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (7, 7782, TO_DATE('2005-06-22', 'YYYY-MM-DD'), TO_DATE('2005-06-25', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (10, 7782, TO_DATE('2005-06-25', 'YYYY-MM-DD'), TO_DATE('2005-06-28', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (13, 7782, TO_DATE('2005-06-28', 'YYYY-MM-DD'), TO_DATE('2005-07-02', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (2, 7839, TO_DATE('2005-06-17', 'YYYY-MM-DD'), TO_DATE('2005-06-21', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (8, 7839, TO_DATE('2005-06-23', 'YYYY-MM-DD'), TO_DATE('2005-06-25', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (14, 7839, TO_DATE('2005-06-29', 'YYYY-MM-DD'), TO_DATE('2005-06-30', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (11, 7839, TO_DATE('2005-06-26', 'YYYY-MM-DD'), TO_DATE('2005-06-27', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (5, 7839, TO_DATE('2005-06-20', 'YYYY-MM-DD'), TO_DATE('2005-06-24', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (3, 7934, TO_DATE('2005-06-18', 'YYYY-MM-DD'), TO_DATE('2005-06-22', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (12, 7934, TO_DATE('2005-06-27', 'YYYY-MM-DD'), TO_DATE('2005-06-28', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (15, 7934, TO_DATE('2005-06-30', 'YYYY-MM-DD'), TO_DATE('2005-07-03', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (9, 7934, TO_DATE('2005-06-24', 'YYYY-MM-DD'), TO_DATE('2005-06-27', 'YYYY-MM-DD'));
INSERT INTO "proj" VALUES (6, 7934, TO_DATE('2005-06-21', 'YYYY-MM-DD'), TO_DATE('2005-06-23', 'YYYY-MM-DD'));


CREATE VIEW "Managers"
   AS SELECT m."ENAME" AS "Manager", e."ENAME" AS "Employee"
   FROM "emp" e LEFT JOIN "emp" m ON e."MGR" = m."EMPNO"
   ORDER BY m."ENAME", e."ENAME";

COMMENT ON TABLE "Managers" IS 'Pairs of manager-subordinate names';

CREATE MATERIALIZED VIEW "Materialized"
   AS SELECT m."ENAME" AS "Manager", e."ENAME" AS "Employee"
   FROM "emp" e LEFT JOIN "emp" m ON e."MGR" = m."EMPNO"
   ORDER BY m."ENAME", e."ENAME";


CREATE TABLE "datatypes" (
   "INT_" NUMBER(*,0) DEFAULT 21321 NOT NULL ENABLE, 
   "INTEGER_" NUMBER(*,0) DEFAULT 2321, 
   "SMALL_INT" NUMBER(*,0) DEFAULT 333, 
   "LONG_" LONG DEFAULT 2312321, 
	
   "DEC_" NUMBER(*,0) DEFAULT 2321, 
   "DECIMAL_" NUMBER(*,0) DEFAULT 21321, 
   "NUMBER_" NUMBER DEFAULT 3212, 
   "NUMERIC_" NUMBER(*,0) DEFAULT 3344, 
   "D_PRECISION" FLOAT(126) DEFAULT 232.666, 
   "FLOAT_" FLOAT(126) DEFAULT 222.55, 
   "REAL_" FLOAT(63) DEFAULT 23423, 
   "B_DOUBLE" BINARY_DOUBLE DEFAULT 42323, 
   "B_FLOAT" BINARY_FLOAT DEFAULT 324234.44, 
	
   "CHAR_" CHAR(1 BYTE) DEFAULT 'd', 
   "CHAR_VAR" VARCHAR2(20 BYTE) DEFAULT 'asdas', 
   "CHARACTER_" CHAR(1 BYTE) DEFAULT 'w', 
   "CHARACTER_VAR" VARCHAR2(20 BYTE) DEFAULT 'hhh', 
   "VAR_CHAR2" VARCHAR2(20 BYTE) DEFAULT 'ASDA', 
   "NCHAR_" NCHAR(1), 
   "NATIONAL_CHAR" NCHAR(1) DEFAULT 'd', 
   "NATIONAL_CHARACTER" NCHAR(1), 
   "NCHAR_VARY" NVARCHAR2(20) DEFAULT 'ffff', 
   "NATIONAL_CHAR_VAR" NVARCHAR2(20) DEFAULT 'ASa', 
   "NATIONAL_CHARACTER_VARYING" NVARCHAR2(20), 
   "VARCHAR_" VARCHAR2(20 BYTE) DEFAULT 'sdds', 
	
   "DATE_" DATE DEFAULT '2012-01-23', 
   "INTERVAL_DAY" INTERVAL DAY (2) TO SECOND (6), 
   "INTERVAL_YEAR" INTERVAL YEAR (2) TO MONTH, 
   "TIMESTAMP_" TIMESTAMP (6), 
	
   "BLOB_" BLOB, 
   "CLOB_" CLOB, 
   "NCLOB_" NCLOB, 
   "BFILE_" BFILE, 
   "UROWID_" UROWID (4000), 
   "ROWID_" ROWID, 
   "RAW_" RAW(20), 

   PRIMARY KEY ("INT_")
);

INSERT INTO "datatypes" (VAR_CHAR2, NUMBER_, DATE_, B_DOUBLE, B_FLOAT, CHAR_, CHAR_VAR, CHARACTER_,
   CHARACTER_VAR, DEC_, DECIMAL_, D_PRECISION, FLOAT_, INT_, INTEGER_, LONG_,
   NATIONAL_CHAR, NATIONAL_CHAR_VAR, NCHAR_VARY, VARCHAR_, SMALL_INT, NUMERIC_) 
   VALUES ('asda', 234, TO_DATE('2012-04-04 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
   23423, 324.44, 'e', 'eee', 't', 'ttt', 324, 342, 12321.33, 333.33,
   33333, 3333333, '3321321', 'd', 'ddd', 'fff', 'ffff', 44, 223423);
   
COMMIT;
EXIT;

